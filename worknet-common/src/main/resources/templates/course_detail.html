<!doctype html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>课程详情</title>
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/css/edua-icons.css">
    <link rel="stylesheet" type="text/css" href="/css/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/css/owl.carousel.css">
    <link rel="stylesheet" type="text/css" href="/css/owl.transitions.css">
    <link rel="stylesheet" type="text/css" href="/css/cubeportfolio.min.css">
    <link rel="stylesheet" type="text/css" href="/css/settings.css">
    <link rel="stylesheet" type="text/css" href="/css/bootsnav.css">
    <link rel="stylesheet" type="text/css" href="/css/style.css">
    <link rel="stylesheet" type="text/css" href="/css/loader.css">
    <link rel="stylesheet" type="text/css" href="/css/button.css">
    <link href="https://cdn.bootcss.com/toastr.js/latest/css/toastr.css" rel="stylesheet">

    <style>
        div.join-btn{
            padding:20px 10px;
            border-radius:10px;
            background:radial-gradient(#ffffff, #ffe59ca8);
            box-shadow:5px 5px 15px #00000054;
            cursor:pointer;
            transition:all 0.3s;
            text-align: center;
        }
        div.join-btn:hover{
            transform:scale(1.04);
            box-shadow:5px 5px 35px #00000054;
            opacity:.84;
        }
        div.join-btn:active{
            transform:scale(0.97);
            box-shadow:5px 5px 15px #00000054;
            opacity:1;
        }
        div.joined-course{
            text-align: center;
            background: white;
            padding:20px 20px;
            border-radius:10px;

        }
    </style>
</head>

<body data-spy="scroll" data-target="#myScrollspy">

<a href="#" class="scrollToTop"><i class="fa fa-angle-up"></i></a>
<!--Loader-->
<div class="loader">
    <div class="bouncybox">
        <div class="bouncy"></div>
    </div>
</div>


<script type="text/javascript" src="/js/header.js"></script>

<!--Search-->
<div id="search">
    <button type="button" class="close">×</button>
    <form>
        <input type="search" value="" placeholder="Search here...." required/>
        <button type="submit" class="btn btn_common blue">Search</button>
    </form>
</div>

<!--Page Header-->
<section class="page_header padding-top">
    <div class="container">
        <div class="row">
            <div class="col-md-12 page-content">
                <div class="page_nav">
                    <span>你的位置:</span> <a href="#" onClick= "javascript :history.back(1)">首页</a> <span><i
                        class="fa fa-angle-double-right"></i>课程详情</span>
                </div>
            </div>
        </div>
    </div>
</section>
<!--Page Header-->

<!-- Courses -->
<section id="course_all" class="padding-bottom-half padding-top-half">
    <div class="container">
        <div class="row">
            <nav class="col-sm-2" id="myScrollspy">
                <ul class="nav nav-tabs nav-stacked" data-spy="affix" data-offset-top="125">
                    <li class="active"><a href="#about">关于</a></li>
                    <li><a href="#menu">章节目录</a></li>
                    <li><a href="#teacher">讲师</a></li>
                    <li><a href="#comment">评价</a></li>
                </ul>
            </nav>
            <div class="col-sm-8 course_detail wow fadeIn" data-wow-delay="400ms">
                <div id="about">
                    <div class="bottom70_border_white"></div>
                    <img src="" alt="Course" class=" border_radius img-responsive bottom15" width="100%">
                    <div class="detail_course bottom20">
                        <div class="info_label">
                            <span class="icony"><i class="icon-users3"></i></span>
                            <p>讲师</p>
                            <h5 class="teacher-name"></h5>
                        </div>
                        <div class="info_label">
                            <span class="icony"><i class="icon-users3"></i></span>
                            <p>分类</p>
                            <h5><span class="course-field"></span> / <span class="course-title"></span></h5>
                        </div>
                        <div class="info_label">
                            <form class="star_rating bottom5">
                                <p>平均评分</p>
                                <p class="no_bottom text-right avg-star"></p>
                            </form>
                        </div>
                        <div class="info_label join-btn margin_left">
                            <h3>报名参加</h3>
                            <p>0000年00月00日</p>
                        </div>
                    </div>
                </div>
                <h3 class=" bottom20 course-title" ></h3>
                <div id="course-abstract"></div>
                <div class="bottom50"></div>
                <div id="menu">
                    <div class="bottom70_border"></div>
                    <h3>章节目录</h3>
                    <div class="bottom20"></div>
                    <div class="panel-group bottom20" id="accordion">

                    </div>

                </div>
                <div class="bottom50"></div>
                <div id="teacher">
                    <div class="bottom70_border"></div>
                    <div class="profile_bg heading_space">
                        <h3 class="bottom20">讲师</h3>
                        <div class="profile" style="width: 100%">
                            <div class="p_pic"><img id="teacher-img" src="" alt="teacher" width="92" height="92"></div>
                            <div class="profile_text">
                                <h5><strong class="teacher-name"></strong> - <span id="teacher-title"></span></h5>
                                <p id="teacher-info"></p>
                                <!--<ul class="social_icon black top20">-->
                                    <!--<li><a href="#." class="facebook"><i class="fa fa-facebook"></i></a></li>-->
                                    <!--<li><a href="#." class="twitter"><i class="icon-twitter4"></i></a></li>-->
                                    <!--<li><a href="#." class="dribble"><i class="icon-dribbble5"></i></a></li>-->
                                <!--</ul>-->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="bottom50"></div>
                <div class="reviews" id="comment">
                    <div class="bottom70_border"></div>
                    <h3 class="bottom20">评价</h3>
                    <div class="row">
                        <div class="col-sm-4 heading_space">
                            <p>平均评分</p>
                            <div class="review_left text-center">
                                <strong class="bottom5 avg-star"></strong>

                            </div>
                        </div>
                        <div class="col-sm-8 heading_space">
                            <div class="rating_progress">
                                <span>Stars 5</span>
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" id="bar5" aria-valuenow="80" aria-valuemin="0"
                                         aria-valuemax="100" style="width:80%;"></div>
                                </div>
                                <span id="eva-5">8</span>
                                <div class="clearfix"></div>
                                <span>Stars 4</span>
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" id="bar4" aria-valuenow="60" aria-valuemin="0"
                                         aria-valuemax="100" style="width:60%;"></div>
                                </div>
                                <span id="eva-4"> 6</span>
                                <div class="clearfix"></div>
                                <span>Stars 3</span>
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" id="bar3" aria-valuenow="40" aria-valuemin="0"
                                         aria-valuemax="100" style="width:40%;"></div>
                                </div>
                                <span id="eva-3"> 3</span>
                                <div class="clearfix"></div>
                                <span>Stars 2</span>
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" id="bar2" aria-valuenow="30" aria-valuemin="0"
                                         aria-valuemax="100" style="width:30%;"></div>
                                </div>
                                <span id="eva-2">1</span>
                                <div class="clearfix"></div>
                                <span>Stars 1</span>
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" id="bar1" aria-valuenow="0" aria-valuemin="0"
                                         aria-valuemax="100" style="width:0%;"></div>
                                </div>
                                <span id="eva-1">0</span>
                            </div>
                        </div>
                    </div>
                </div>
                <a id="moreComment" class="Button_1">查看更多评论</a>
            </div>
            <div class="col-sm-2"></div>
        </div>
    </div>
</section>
<!-- Courses -->


<script type="text/javascript" src="/js/footer.js"></script>


<script src="/js/jquery-2.2.3.js"></script>
<script src="https://cdn.bootcss.com/toastr.js/latest/js/toastr.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/bootsnav.js"></script>
<script src="/js/jquery.appear.js"></script>
<script src="/js/jquery-countTo.js"></script>
<script src="/js/jquery.parallax-1.1.3.js"></script>
<script src="/js/owl.carousel.min.js"></script>
<script src="/js/jquery.cubeportfolio.min.js"></script>
<script src="/js/jquery.themepunch.tools.min.js"></script>
<script src="/js/jquery.themepunch.revolution.min.js"></script>
<script src="/js/revolution.extension.layeranimation.min.js"></script>
<script src="/js/revolution.extension.navigation.min.js"></script>
<script src="/js/revolution.extension.parallax.min.js"></script>
<script src="/js/revolution.extension.slideanims.min.js"></script>
<script src="/js/revolution.extension.video.min.js"></script>
<script src="/js/wow.min.js"></script>
<script src="/js/functions.js"></script>
<script>
    Date.prototype.Format = function (fmt) { //author: meizz
        var o = {
            "M+": this.getMonth() + 1, //月份
            "d+": this.getDate(), //日
            "H+": this.getHours(), //小时
            "m+": this.getMinutes(), //分
            "s+": this.getSeconds(), //秒
            "q+": Math.floor((this.getMonth() + 3) / 3), //季度
            "S": this.getMilliseconds() //毫秒
        };
        if (/(y+)/.test(fmt)) fmt = fmt.replace(RegExp.$1, (this.getFullYear() + "").substr(4 - RegExp.$1.length));
        for (var k in o)
            if (new RegExp("(" + k + ")").test(fmt)) fmt = fmt.replace(RegExp.$1, (RegExp.$1.length == 1) ? (o[k]) : (("00" + o[k]).substr(("" + o[k]).length)));
        return fmt;
    };
    var isJoined = 0;
    $('#moreComment').on('click',function (object) {
        if(isJoined===0){
            toastr.warning('请先报名参加该课程');
            $('body,html').animate({scrollTop:$('.join-btn').offset().top-100},500);
        }else{
            let url = window.location.href;
            let ut= url.split("#");
            let u=ut[0];
            window.location.href=u+'moreComment';
        }
    });
    $(document).ready(function () {
        var href = window.location.href;
        href = href.substring(0,href.lastIndexOf("\/"));
        var cid = parseInt(href.substring(href.lastIndexOf("\/")+1,href.length));
        $.get('/personal/get/joinedCourse/'+cid,{},function (data) {
            data = JSON.parse(data);
            if(data.errorCode==='00'){
                let obj = data.returnObject;
                if(obj.isJoined){
                    $('.join-btn h3').html('已报名');
                    $('.join-btn p').html(obj.joinTime);
                    $('.join-btn').addClass('joined-course');
                    $('.join-btn').removeClass('join-btn');
                    isJoined = 1;
                }else{
                    $('.join-btn p').html(new Date().Format("yyyy-MM-dd"));
                    $('.join-btn').on('click',function (object) {
                        if(uid !== undefined){
                            $.get('/personal/study/course/'+cid,{joinTime:new Date().Format("yyyy-MM-dd")},function (data) {
                                data = JSON.parse(data);
                                if(data.errorCode==='00'){
                                    toastr.success('报名成功');
                                    setTimeout(function () {
                                        window.location.reload();
                                    },300);
                                }else{
                                    toastr.warning('报名失败');
                                }
                            });
                        }else {
                            toastr.warning('请先登录');
                            window.location.href = '/login';
                        }
                    });
                }
            }
        });
        $('#about').find('img').attr('src','/get/course/view/'+cid);//图片预览
        $.get('/get/course/basicInfo/'+cid,{},function (data) {
            data = JSON.parse(data);
            if(data.errorCode==='00'){
                let obj = data.returnObject;
                $('.course-title').html(obj.title);
                $('.course-field').html(obj.field);
                $('#course-abstract').html(obj.abstract);//是直接的html代码
                $('#teacher-img').attr('src','/get/avatar/'+obj.teacherId);
                $('.teacher-name').html(obj.teacherName);
                $('#teacher-title').html(obj.teacherTitle);
                $('#teacher-info').html(obj.teacherInfo);
            }
        });//基本信息
        //章节目录
        $.get('/get/course/menu/'+cid,{},function (data) {
            data = JSON.parse(data);
            let $div = $('#accordion');
            if(data.errorCode==='00'){
                let obj = data.returnObject;//obj应该是一个list，每一项带有
                // console.log(obj);
                for(let i = 0; i < obj.length; i++){
                    let item = obj[i];
                    let $$div = $('                        <div class="panel panel-default">\n' +
                        '                            <div class="panel-heading">\n' +
                        '                                <h4 class="panel-title">\n' +
                        '                                    '+item.title+'\n' +
                        '                                    <a data-toggle="collapse" data-parent="#accordion"\n' +
                        '                                       href="#collapse_'+i+'" class="margin_left">\n' +
                        '                                          查看\n' +
                        '                                    </a>\n' +
                        '                                </h4>\n' +
                        '                            </div>\n' +
                        '                            <div id="collapse_'+i+'" class="panel-collapse collapse ">\n' +
                        '                            </div>\n' +
                        '                        </div>\n' +
                        '                        <div class="bottom5"></div>');
                    let smenu = item.subMenu;
                    for(let j = 0; j < smenu.length; j++){
                        let $$$div = $('<div class="panel-body">\n' +
                            '                                    '+smenu[j].title+'<a class="Button_1">查看视频</a>\n' +
                            '                                </div>\n');
                        $$$div.find('a').on('click',function () {
                            if(isJoined===0){
                                toastr.warning('请先报名参加该课程');
                                $('body,html').animate({scrollTop:$('.join-btn').offset().top-100},500);
                            }else{
                                let url = window.location.href;
                                let ut= url.split("#");
                                let u=ut[0];
                                window.location.href=u+'video/#'+smenu[j].vid;
                            }
                        });
                        $$div.find('#collapse_'+i).append($$$div);//应该可以
                    }
                    $div.append($$div);
                }
            }
        });
        //评价信息
        $.get('/get/course/evaluation/'+cid,{},function (data) {
            data = JSON.parse(data);
            if(data.errorCode==='00'){
                let tot = 0;
                let obj = data.returnObject;
                //评分
                $('.avg-star').html(obj.avgStar);
                for(let i = 1; i <= 5; i++){
                    let star = 'star'+i;
                    $('#eva-'+(i)).html(obj[star]);
                    tot += obj[star];
                }
                for(let i = 1; i <= 5; i++){
                    let star = 'star'+i;
                    $('#bar'+(i)).css('width',(obj[star]*100/tot)+"%");
                }
                //具体评价
                let list = obj.evaluations;
                let $com = $('#comment');
                for(let i = 0; i < list.length; i++){
                    let item = list[i];
                    let fst = '                <div class="profile_border">\n';
                    if(i===list.length-1)
                        fst = '                <div class="profile_border heading_space">\n';
                    let tmp = '';
                    for(let j = 1; j <= 5; j++){
                        if(j===item.stars)
                            tmp += '                                    <input type="radio" name="star" class="star-'+j+'" checked />\n';
                        else
                            tmp += '                                    <input type="radio" name="star" class="star-'+j+'"/>\n';
                    }
                    $com.append('\n' +
                        fst +
                        '                    <div class="profile top20 bottom20">\n' +
                        '                        <div class="p_pic"><a href="/info/'+item.uid+'/"><img src="/get/avatar/'+item.uid+'" alt="avatar" width="92" height="92"></a></div>\n' +
                        '                        <div class="profile_text" style="width: 100%;padding-left: 30px;">\n' +
                        '                            <h5><strong><a href="/info/'+item.uid+'/">'+item.nickname+'</a></strong></h5>\n' +
                        '                            <form class="star_rating bottom5">\n' +
                        '                                <div class="stars">\n' +tmp+
                        '                                    <span></span>\n' +
                        '                                </div>\n' +
                        '                            </form>\n' +
                        '                            <p class="margin10">'+item.content+'</p>\n' +
                        '                        </div>\n' +
                        '                    </div>\n' +
                        '                </div>');
                }
            }
        });
    });
</script>
</body>
</html>
