<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/personal/css/myMsg.css" />
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.15.2/dist/bootstrap-table.min.css">
    <link rel="stylesheet" type="text/css" href="/css/edua-icons.css">
    <style>
        div#myModal{
            transform:translateY(-5%);
        }
    </style>
</head>
<body>
<div class='main'>
    <table id="stu-account"></table>
</div>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <!--登陆框头部-->
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    ×
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    修改学生信息
                </h4>
            </div>
            <!--登陆框中间部分(from表单)-->
            <div class="modal-body">
                <form class="form-horizontal" role="form">
                    <div class="form-group">
                        <label for="nickname" class="col-sm-2 control-label" >昵称</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="nickname" id="nickname" placeholder="昵称" required="required">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="realname" class="col-sm-2 control-label" >真实姓名</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="realname" id="realname" placeholder="真实姓名" required="required">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="sex" class="col-sm-2 control-label" >性别</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="sex" id="sex" placeholder="性别" required="required">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="age" class="col-sm-2 control-label" >年龄</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="age" id="age" placeholder="年龄" required="required">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="signature" class="col-sm-2 control-label" >个性签名</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="signature" id="signature" placeholder="个性签名" required="required">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="vacation" class="col-sm-2 control-label" >学历</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="vacation" id="vacation" placeholder="学历" required="required">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="github" class="col-sm-2 control-label" >GitHub</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="github" id="github" placeholder="GitHub" required="required">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="email" class="col-sm-2 control-label" >邮箱</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="email" id="email" placeholder="邮箱" required="required">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="phone" class="col-sm-2 control-label" >手机</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="phone" id="phone" placeholder="手机" required="required">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="hobby" class="col-sm-2 control-label" >兴趣</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="hobby" id="hobby" placeholder="兴趣" required="required">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="professional" class="col-sm-2 control-label" >目标职业</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="professional" id="professional" placeholder="目标职业" required="required">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10">
                            <span class="btn btn-success" id="change-info">确认修改</span>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript" src="/personal/js/vendor/jquery-1.12.4.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.15.2/dist/bootstrap-table.min.js"></script>
<script>
    $('.main').height($(window).height());
    var stuInfo;
    $('#myModal').on('show.bs.modal',function (object) {
        $.each(stuInfo,function (k) {
            let key = k;
            let val = stuInfo[key];
            let $t = $('#'+key);
            $t.val(val);
            $t.on('change',function (object1) {
                stuInfo[key] = $(this).val();
            });
        });
    });
    $('#change-info').on('click',function (object) {
        console.log(stuInfo);
        $.post('/admin/change-info',
            stuInfo,function (data) {
            data = JSON.parse(data);
            if(data.errorCode=='00'){
                window.top.showToastr(0,"修改信息成功");
                $('#stu-account').bootstrapTable('refresh');
                $('#myModal').modal('hide');
            }else{
                window.top.showToastr(2,"未知错误");
            }
        }).error(function () {
            window.top.showToastr(2,"未知错误");
        });
    });
    dynamicTable = $("#stu-account").bootstrapTable({
        url: "/admin/get/stu-info",
        striped: true,
        pagination: true,
        singleSelect: true,
        clickToSelect: true,
        showColumns:true,
        pageNumber:1,
        pageSize: 10,
        pageList: [5, 10, 20],
        sidePagination: "server",
        queryParamsType: "",
        search: true,
        queryParams: function getPageMessage(params){
            let temp={
                pageSize: params.pageSize,
                pageNumber: params.pageNumber,
                searchText:params.searchText
            };
            return temp;
        },
        minimunCountColumns: 2,
        height:$(window).height()*0.85,
        onLoadSuccess:function(data){
            $('span.edit-info').on('click',function (object) {
                stuInfo = JSON.parse($(this).attr('data-json'));
                $('#myModal').modal('show');
            });
            $('.search-input').attr('placeholder',"搜索姓名/id/昵称/手机号");
        },
        columns:[{
            field:"userId",
            title:"学生id",
            align: "center"
        },{
            field:"nickname",
            title:"昵称",
            align: "center"
        },{
            field:"realname",
            title:"真实姓名",
            align: "center"
        },{
            field:"sex",
            title:"性别",
            align: "center"
        },{
            field:"age",
            title:"年龄",
            align: "center"
        },{
            field:"signature",
            title:"个性签名",
            align: "center"
        },{
            field:"vacation",
            title:"学历",
            align: "center"
        },{
            field:"github",
            title:"GitHub",
            align: "center"
        },{
            field:"email",
            title:"邮箱",
            align: "center"
        },{
            field:"phone",
            title:"手机",
            align: "center"
        },{
            field:"hobby",
            title:"兴趣",
            align: "center"
        },{
            field:"professional",
            title:"目标职业",
            align: "center"
        },{
            field:"edit",
            title:"操作",
            align: "center",
            formatter: function(v,r,i){
                return "<span data-json='"+JSON.stringify(r)+"' class='btn btn-success btn-xs edit-info'>修改</span>";
            }
        }]
    });

</script>
</body>
</html>