<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="/personal/css/myMsg.css" />
    <link rel="stylesheet" type="text/css" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.15.2/dist/bootstrap-table.min.css">
    <link rel="stylesheet" type="text/css" href="/css/edua-icons.css">
    <link rel="stylesheet" type="text/css" href="/css/bootstrap-select.css">
    <style>
        span a i{
            padding-right:3px;
        }
        #stu-account td{
            max-width:100px;
            text-overflow:ellipsis;
            overflow:hidden;
            white-space:nowrap;
            word-break:keep-all;
        }
        #stu-account .operate{
            margin-right:5px;
            font-size:1.2em;
            text-decoration:none;
            cursor:pointer;
        }
        #stu-account .operate:hover{
            color:#00145d;
            text-shadow:1px 1px #00000061;
        }

        input#isPractice{
            width:1.5em;
            height:1.5em;
        }
        #myModal{
            transform: translateY(-3%);
        }
        #create-employ{
            position:fixed;
            left:20px;
            top:10px;
        }
    </style>
</head>
<body>
<div class='main'>
    <span class="btn btn-success" id="create-employ">添加招聘信息</span>
    <table id="stu-account"></table>
</div>

<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <!--登陆框头部-->
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                    ×
                </button>
                <h4 class="modal-title" id="myModalLabel">
                    招聘信息
                </h4>
            </div>
            <!--登陆框中间部分(from表单)-->
            <div class="modal-body">
                <form class="form-horizontal" role="form">
                    <div class="form-group">
                        <label for="title" class="col-sm-2 control-label" >招聘标题</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="title" id="title" placeholder="招聘标题" required="required">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="isPractice" class="col-sm-2 control-label" >是否实习</label>
                        <div class="col-sm-10">
                            <input type="checkbox" name="isPractice" id="isPractice">
                        </div>
                    </div>
                    <div  id="practice-group">
                        <div class="form-group">
                            <label for="duration" class="col-sm-2 control-label" >实习时长</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" name="duration" id="duration" placeholder="实习时长" required="required">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="chanceToFormal" class="col-sm-2 control-label" >转正机会</label>
                            <div class="col-sm-10">
                                <input type="text" class="form-control" name="chanceToFormal" id="chanceToFormal" placeholder="是否转正" required="required">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="salary" class="col-sm-2 control-label" >薪酬</label>
                        <div class="col-sm-10">
                            <input type="text" class="form-control" name="salary" id="salary" placeholder="薪酬" required="required">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="location" class="col-sm-2 control-label" >就职地点</label>
                        <div class="col-sm-10">
                            <select id="location" name="location" class="input-xlarge selectpicker">
                                <option value="北京">北京</option>
                                <option value="上海">上海</option>
                                <option value="广州">广州</option>
                                <option value="深圳">深圳</option>
                                <option value="杭州">杭州</option>
                                <option value="南京">南京</option>
                                <option value="成都">成都</option>
                                <option value="厦门">厦门</option>
                                <option value="武汉">武汉</option>
                                <option value="西安">西安</option>
                                <option value="长沙">长沙</option>
                                <option value="哈尔滨">哈尔滨</option>
                                <option value="合肥">合肥</option>
                                <option value="其他">其他</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="professionTypeId" class="col-sm-2 control-label" >岗位种类</label>
                        <div class="col-sm-10">
                            <select id="professionTypeId" name="professionTypeId" class="input-xlarge selectpicker">
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="introduction" class="col-sm-2 control-label" >岗位介绍</label>
                        <div class="col-sm-10">
                            <textarea rows="5" class="form-control" name="introduction" id="introduction" placeholder="招聘介绍" required="required"></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="requirement" class="col-sm-2 control-label" >岗位要求</label>
                        <div class="col-sm-10">
                            <textarea rows="5" class="form-control" name="requirement" id="requirement" placeholder="岗位要求" required="required"></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10">
                            <span class="btn btn-success" id="change-info">确认修改</span>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript" src="/personal/js/vendor/jquery-1.12.4.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.15.2/dist/bootstrap-table.min.js"></script>
<script src="/js/bootstrap-select.js"></script>
<script>
    $('.main').height($(window).height());
    var employInfo={};
    $('#isPractice').on('change',function (object) {
        if($(this).is(':checked')){
            $('#practice-group').slideDown();
            employInfo.isPractice = 1;
        } else {
            $('#practice-group').slideUp();
            employInfo.isPractice = 0;
        }
    });
    $('#myModal').on('show.bs.modal',function (object) {
        $.each($('input'),function (k) {
            let key = $(this).attr('id');
            let val = employInfo[key];
            $(this).val(val);
            $(this).on('change',function (object1) {
                employInfo[key] = $(this).val();
            });
        });
        $.each($('textarea'),function (k) {
            let key = $(this).attr('id');
            let val = employInfo[key];
            $(this).val(val);
            $(this).on('change',function (object1) {
                employInfo[key] = $(this).val();
            });
        });
    });
    //获取职业分类
    $.get("/getVocationType",function (data) {
        data = JSON.parse(data);
        if(data.errorCode=='00'){
            let lst = data.returnObject;
            let $s3 = $('#professionTypeId');
            lst.forEach(function (val,idx) {
                $s3.append('<option value="'+val.professionId+'">'+val.profession+'</option>');
            });
        }
    });

    $('#create-employ').on('click',function (object) {
        employInfo = {};
        $('input').val('');
        $('textarea').val('');
        $('#isPractice').prop('checked',false);
        employInfo.professionTypeId = 1;
        employInfo.location = '北京';
        $.each($('input'),function (k) {
            let key = $(this).attr('id');
            let val = employInfo[key];
            $(this).val(val);
            $(this).on('change',function (object1) {
                employInfo[key] = $(this).val();
            });
        });
        $.each($('textarea'),function (k) {
            let key = $(this).attr('id');
            let val = employInfo[key];
            $(this).val(val);
            $(this).on('change',function (object1) {
                employInfo[key] = $(this).val();
            });
        });
        $.each($('select'),function (k) {
            let key = $(this).attr('id');
            let val = employInfo[key];
            $(this).val(val);
            $(this).on('change',function (object1) {
                employInfo[key] = $(this).val();
            });
        });
        $('#professionTypeId').selectpicker('refresh');
        $('#location').selectpicker('refresh');
        $('#practice-group').slideUp();
        $('#change-info').html('确认添加');
        $('#myModal').modal('show');
    });
    //创建招聘信息，要求把employInfo清空，然后提交即可。



    $('#change-info').on('click',function (object) {
        console.log(employInfo);
        if($('#isPractice').is(':checked')){
            employInfo.isPractice = 1;
        } else {
            employInfo.isPractice = 0;
        }
        if($(this).html()=='确认修改'){
            $.post('/company/employ/change-info',
                employInfo,function (data) {
                    data = JSON.parse(data);
                    if(data.errorCode=='00'){
                        window.top.showToastr(0,"修改信息成功");
                        $('#stu-account').bootstrapTable('refresh');
                        $('#myModal').modal('hide');
                    }else{
                        window.top.showToastr(2,"未知错误");
                    }
                }).error(function () {
                window.top.showToastr(2,"未知错误");
            });
        }else{
            $.post('/company/employ/create-info',
                employInfo,function (data) {
                    data = JSON.parse(data);
                    if(data.errorCode=='00'){
                        window.top.showToastr(0,"创建招聘成功");
                        $('#stu-account').bootstrapTable('refresh');
                        $('#myModal').modal('hide');
                    }else{
                        window.top.showToastr(2,"未知错误");
                    }
                }).error(function () {
                window.top.showToastr(2,"未知错误");
            });
        }
    });
    dynamicTable = $("#stu-account").bootstrapTable({
        url: "/company/get/employ-info",
        striped: true,
        pagination: true,
        singleSelect: true,
        clickToSelect: true,
        showColumns:true,
        pageNumber:1,
        pageSize: 10,
        pageList: [5, 10, 20],
        sidePagination: "server",
        queryParamsType: "",
        search: true,
        queryParams: function getPageMessage(params){
            let temp={
                pageSize: params.pageSize,
                pageNumber: params.pageNumber,
                searchText:params.searchText
            };
            return temp;
        },
        minimunCountColumns: 2,
        height:$(window).height()*0.85,
        onLoadSuccess:function(data){
            $('a.end-employ').on('click',function (object) {
                let id = parseInt($(this).attr('data-id'));
                $.get('/company/end/employ/'+id,function (data) {
                    data = JSON.parse(data);
                    if(data.errorCode=="00"){
                        window.top.showToastr(0,"已关闭该招聘信息");
                        $('#stu-account').bootstrapTable("refresh");
                    }else{
                        window.top.showToastr(2,"未知错误");
                    }
                }).error(function () {
                    window.top.showToastr(2,"未知错误");
                });
            });
            $('a.edit-employ').on('click',function (object) {
                $('input').val('');
                $('textarea').val('');
                employInfo = JSON.parse($(this).attr('data-json'));
                if(employInfo.isPractice){
                    $('#isPractice').prop('checked',true);
                    $('#practice-group').slideDown();
                }
                else{
                    $('#isPractice').prop('checked',false);
                    $('#practice-group').slideUp();
                }
                $('#professionTypeId').selectpicker('refresh');
                //出现一个modal
                $('#change-info').html('确认修改');
                $('#myModal').modal('show');
            });
            $('.search-input').attr('placeholder',"搜索标题/简介/需求");
        },
        columns:[{
            field:"title",
            title:"招聘标题",
            align: "center",
            formatter:function (v,r,i) {
                return "<span title='"+v+"'>"+v+"</span>";
            }
        },{
            field:"salary",
            title:"薪酬",
            align: "center",
            formatter:function (v,r,i) {
                return "<span title='"+v+"'>"+v+"</span>";
            }
        },{
            field:"location",
            title:"就职地点",
            align: "center",
            formatter:function (v,r,i) {
                return "<span title='"+v+"'>"+v+"</span>";
            }
        },{
            field:"professionType",
            title:"职位分类",
            align: "center",
            formatter:function (v,r,i) {
                return "<span title='"+v+"'>"+v+"</span>";
            }
        },{
            field:"introduction",
            title:"简介",
            align: "center",
            formatter:function (v,r,i) {
                return "<span title='"+v+"'>"+v+"</span>";
            }
        },{
            field:"requirement",
            title:"需求",
            align: "center",
            formatter:function (v,r,i) {
                return "<span title='"+v+"'>"+v+"</span>";
            }
        },{
            field:"isPractice",
            title:"是否实习",
            align: "center",
            formatter:function (v,r,i) {
                switch(v){
                    case false:return "<span>否</span>";
                    case true:return "<span>是</span>";
                }
                return '';
            }
        },{
            field:"duration",
            title:"实习时间",
            align: "center",
            formatter:function (v,r,i) {
                switch(r.isPractice){
                    case false:return "<span>-</span>";
                    case true:return "<span title='"+v+"'>"+v+"</span>";
                }
                return '';
            }
        },{
            field:"chanceToFormal",
            title:"转正机会",
            align: "center",
            formatter:function (v,r,i) {
                switch(r.isPractice){
                    case false:return "<span>-</span>";
                    case true:return "<span>"+v+"</span>";
                }
                return '';
            }
        },{
            field:"state",
            title:"招聘状态",
            align: "center",
            formatter:function (v,r,i) {
                switch(v){
                    case 1:return "<div class='btn-group'>"+
                        "<span class='label label-success'>进行中</span>"+
                        "</div>";
                    case 0:return "<div class='btn-group'>"+
                        "<span class='label label-danger'>已结束</span>"+
                        "</div>";
                }
                return '';
            }
        },{
            field:"operate",
            title:"快捷操作",
            align: "center",
            formatter:function (v,r,i) {
                switch(r.state){
                    case 0:return "<span class='btn btn-xs btn-default' disabled='true'>已关闭</span>";
                    case 1:return "<a data-id='"+r.id+"' class='operate end-employ'><i class='icon icon-lock' title='结束招聘'></i></a>" +
                        "<a data-json='"+JSON.stringify(r)+"' class='edit-employ operate'><i class='icon icon-pencil' title='修改招聘信息'></i></a>" +
                        "<a href='/working/"+r.companyId+"/job/"+r.id+"/' target='_blank'" +
                        " class='jump-employ operate'><i class='icon icon-link' title='跳转页面'></i></a>";
                }
                return '';
            }
        }]
    });

</script>
</body>
</html>